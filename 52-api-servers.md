# API-серверы

В ряде случаев требуется написать простой API-сервер, реализующий простую выдачу
данных в фиксированном формате третьестороннему ресурсу. Эта секция будет
рассматрвиать именно такой случай, не затрагивая написание больших полноценных
серверов приложения, которые могут реализовывать свой интерфейс.

## Сущности

В библиотеке, реализующей такой сервер, в обязательном порядке должны быть
описаны все используемые сущности. В отличие от клиента, где работа без
сущностей просто затруднительна, в сервере они необходимы для формирования
вывода провайдеров. Сущности реализуются даже в том случае, если они полностью
повторяют модели приложения.

## Провайдеры

Передача данных библиотеке осуществляется через провайдеров. Для каждой выдачи
создается интерфейс *провайдера* - такого класса, который принимает на вход
параметры выдачи и выдает сущность или массив сущностей, предусмотренных
конкретной выдачей.

## Вывод библиотеки

Библиотека предоставляет вывод в виде объекта Response пакета
[symfony/http-foundation][], не производя никаких реальных действий по выводу

## Работа с библиотекой

Работа может быть осуществлена двумя способами:

* Каждая выдача представляет собой метод библиотеки, первым методом которого
передается провайдер, а остальные соответствуют аргументам выдачи.
* Каждая выдача представляет собой метод с аргументами, соответствующими
аргументам выдачи, а экземпляры провайдеров или их классы регистрируются до
вызова метода выдачи.

При наличии большого количества аргументов метода имеет смысл реализовать
сущность `{QueryName}Criteria`, которая будет заполняться этими аргументами.

## Логирование

Выполняется за счет таких же слушателей и фильтров, как и в клиентах API. Сама
библиотека не выполняет логирование и не обязана его реализовывать (хоть и может
предоставить базовую реализацию).

## Библиотека с расширенными возможностями

При необходимости библиотека может существовать полноценным 
standalone-приложением, самостоятельно перехватывая вызовы и выдавая ответ. В
этом случае этим занимается дополнительный уровень, а провайдеры региструются на
уровне конфигурации.

## Заключение

Подобный подход обеспечивает низкую связность сервера, упрощенное тестирование и
возможность легкого переиспользования библиотеки. При таком подходе сама
библиотека даже не занимается непосредственной выдачей ответа, поэтому может
быть легко встроена в любые приложения.
